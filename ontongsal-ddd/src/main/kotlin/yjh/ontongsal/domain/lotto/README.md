# 로또 시스템 요구사항 정리

## ☑️ 도메인 설계

- 책임 & 일관성 집합 기준으로 애그리거트 나누기.
- 애그리거트를 나누기 어렵다면 경험상 "이벤트 스토밍"을 해보면 도출하기 쉬워진다.

---

# ☑️ 로또 요구사항 정리

- `로또 번호 (LottoNumber, LottoNumbers)`
  - 도메인 규칙
    - [x] 숫자는 1 ~ 45 범위여야 한다.
    - [x] 한 응모권의 번호는 6개여야 한다.
    - [x] 번호는 중복될 수 없다.


- `로또 회차 (Lotto)`
  - 도메인 규칙
    - [ ] 회차 번호는 1 이상 이어야 한다.
    - [ ] 진행 기간: `startAt` < `endAt` 이어야 한다.
    - [ ] 회차 활성화 상태(`isActive`)를 관리 한다.
    - [ ] 로또 응모 가능 여부:
        - [ ] 회차가 활성화 상태일 것
        - [ ] 현재 시각이 `startAt`과 `endAt` 사이일 것
    - [ ] 추첨 가능 여부:
        - [ ] 회차 진행이 종료되어야만 추첨 가능
        - [ ] 이미 당첨 번호가 존재하면 추첨 불가능
    - [ ] PrizePolicy 상금 비율
      - [ ] 1등: 6개 번호 일치
      - [ ] 2등: 5개 번호 + 보너스 번호 일치
      - [ ] 3등: 5개 번호 일치
      - [ ] 4등: 4개 번호 일치
      - [ ] 5등: 3개 번호 일치
      - [ ] 상금 총합은 100%를 초과할 수 없다.
  - 비즈니스 규칙
    - [ ] 현재 진행 중인 회차가 존재하면 새 회차 등록 불가
    - [ ] 최신 회차 번호의 다음번호의 회차만 등록 가능
    - [ ] 신규 회차 등록시 DB에 저장
    - [ ] 회차 정보 수정시 DB에 저장


- `로또 티켓 (Ticket)`
  - 도메인 규칙
    - [ ] 티켓은 1장 단위로 사용 가능하다.
    - [ ] 티켓은 0보다 작을 수 없다.


- `로또 응모 (Entry)`
  - 도메인 규칙
    - [x] 숫자는 1 ~ 45 범위여야 한다.
    - [x] 응모권의 번호는 총 6개여야 한다.
    - [x] 6자리 번호는 중복될 수 없다.
  - 비즈니스 규칙
    - [ ] 응모 시 회차가 활성화 상태이고 진행 중일 때만 허용
    - [ ] 응모 시 티켓 1장 차감
    - [ ] 응모 내역 + 티켓 카운트 트랜잭션 관리
    - [ ] 동시성 문제 고려


- `로또 추첨 (Draw)`
  - 도메인 규칙
    - [ ] 당첨 번호 6개 + 보너스 번호 1개는 모두 유니크
    - [ ] 당첨 등수 계산:
      - [ ] 6개 번호 일치 → 1등
          - [ ] 5개 번호 + 보너스 번호 일치 → 2등
          - [ ] 5개 번호 일치 → 3등
          - [ ] 4개 번호 일치 → 4등
          - [ ] 3개 번호 일치 → 5등
  - 비즈니스 규칙
    - [ ] 회차 종료 후에만 추첨 가능
    - [ ] 당첨 번호 생성 후 DB 저장
    - [ ] PrizePolicy 에 따라 각 등수별 상금 배분
    - [ ] 당첨 결과 DB 저장 및 사용자 알림
